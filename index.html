<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ãŠç”³ã—è¾¼ã¿</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root { --primary: #6c5ce7; --bg: #f4f7f9; }
    body { font-family: sans-serif; background-color: var(--bg); padding: 15px; color: #333; }
    h2 { text-align: center; color: var(--primary); font-size: 1.2rem; }
    .section-title { font-weight: bold; margin: 20px 0 10px; border-left: 4px solid var(--primary); padding-left: 10px; font-size: 0.95rem;}
    .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
    
    label { display: block; font-size: 0.8rem; margin-bottom: 5px; color: #666; font-weight: bold; }
    .must { color: red; margin-left: 4px; }
    .flex { display: flex; gap: 10px; }
    .flex > div { flex: 1; }
    
    input, select, textarea { 
      width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem;
    }
    
    .btn-submit { 
      width: 100%; padding: 16px; background: #06C755; color: white; border: none; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
    }
    .btn-submit:active { opacity: 0.8; }
  </style>
</head>
<body>

<h2>ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³è©³ç´°è¨­å®š ğŸŒ™</h2>

<div class="card">
  <div class="section-title">å®‰å¦ç¢ºèªã®è¨­å®š</div>
  <label>é€ä»˜å¸Œæœ›æ™‚é–“<span class="must">*</span></label>
  <input type="time" id="send_time" required value="08:00">

  <div class="section-title">ã”æœ¬äººæ§˜æƒ…å ±</div>
  <label>ãŠåå‰ï¼ˆæ¼¢å­—ï¼‰<span class="must">*</span></label>
  <div class="flex">
    <input type="text" id="user_last_name" placeholder="è‹—å­—" required>
    <input type="text" id="user_first_name" placeholder="åå‰" required>
  </div>
  
  <label>ãƒ•ãƒªã‚¬ãƒŠï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰<span class="must">*</span></label>
  <div class="flex">
    <input type="text" id="user_last_kana" placeholder="ãƒŸãƒ§ã‚¦ã‚¸" required pattern="[ã‚¡-ãƒ´ãƒ¼]*">
    <input type="text" id="user_first_kana" placeholder="ãƒŠãƒã‚¨" required pattern="[ã‚¡-ãƒ´ãƒ¼]*">
  </div>

  <label>ã”ä½æ‰€<span class="must">*</span></label>
  <textarea id="user_address" rows="2" placeholder="æ±äº¬éƒ½æ¸¯åŒº..." required></textarea>
  
  <label>é›»è©±ç•ªå·<span class="must">*</span></label>
  <input type="tel" id="user_tel" placeholder="09012345678" required>
  
  <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="must">*</span></label>
  <input type="email" id="user_email" placeholder="example@mail.com" required>

  <div class="section-title">ç·Šæ€¥é€£çµ¡å…ˆ</div>
  <label>ç¶šæŸ„ï¼ˆã”æœ¬äººã‹ã‚‰è¦‹ã¦ï¼‰<span class="must">*</span></label>
  <select id="emergency_rel" required>
    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    <option value="å¤«ãƒ»å¦»">å¤«ãƒ»å¦»</option>
    <option value="é•·ç”·ãƒ»æ¬¡ç”·ä»¥é™">æ¯å­ï¼ˆé•·ç”·ãƒ»æ¬¡ç”·ä»¥é™ï¼‰</option>
    <option value="é•·å¥³ãƒ»æ¬¡å¥³ä»¥é™">å¨˜ï¼ˆé•·å¥³ãƒ»æ¬¡å¥³ä»¥é™ï¼‰</option>
    <option value="çˆ¶ãƒ»æ¯">çˆ¶ãƒ»æ¯</option>
    <option value="å…„å¼Ÿãƒ»å§‰å¦¹">å…„å¼Ÿãƒ»å§‰å¦¹</option>
    <option value="è¦ªæˆš">è¦ªæˆš</option>
    <option value="å‹äººãƒ»çŸ¥äºº">å‹äººãƒ»çŸ¥äºº</option>
    <option value="ãã®ä»–">ãã®ä»–</option>
  </select>

  <label>ãŠåå‰ï¼ˆãƒ•ãƒ«ãƒãƒ¼ãƒ ï¼‰<span class="must">*</span></label>
  <input type="text" id="emergency_name" placeholder="å±±ç”° ä¸€éƒ" required>
  
  <label>LINE ID<span class="must">*</span></label>
  <input type="text" id="emergency_line" placeholder="å¿…é ˆé …ç›®ã§ã™" required>
  
  <label>é›»è©±ç•ªå·<span class="must">*</span></label>
  <input type="tel" id="emergency_tel" placeholder="08012345678" required>
  
  <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="must">*</span></label>
  <input type="email" id="emergency_email" placeholder="family@mail.com" required>

  <label>ã”ä½æ‰€ï¼ˆä»»æ„ï¼‰</label>
  <textarea id="emergency_address" rows="2" placeholder="ä»»æ„é …ç›®ã§ã™"></textarea>
</div>

<button class="btn-submit" onclick="submitForm()">ä¿å­˜ã—ã¦æ±ºæ¸ˆã¸é€²ã‚€</button>

<script>
// --- è¨­å®šé …ç›® ---
const LIFF_ID = "ã‚ãªãŸã®LIFF_ID";
const MAKE_WEBHOOK_URL = "ã‚ãªãŸã®Makeç”¨WebhookURL";
const STRIPE_URL = "ã‚ãªãŸã®Stripeãƒªãƒ³ã‚¯";

async function initLIFF() {
  await liff.init({ liffId: LIFF_ID });
  if (!liff.isLoggedIn()) { liff.login(); }
}

async function submitForm() {
  const profile = await liff.getProfile();
  
  // ãƒ‡ãƒ¼ã‚¿å–å¾—
  const formData = {
    userId: profile.userId,
    sendTime: document.getElementById('send_time').value,
    userLastName: document.getElementById('user_last_name').value,
    userFirstName: document.getElementById('user_first_name').value,
    userLastKana: document.getElementById('user_last_kana').value,
    userFirstKana: document.getElementById('user_first_kana').value,
    userAddress: document.getElementById('user_address').value,
    userTel: document.getElementById('user_tel').value,
    userEmail: document.getElementById('user_email').value,
    emergencyRel: document.getElementById('emergency_rel').value,
    emergencyName: document.getElementById('emergency_name').value,
    emergencyLine: document.getElementById('emergency_line').value,
    emergencyTel: document.getElementById('emergency_tel').value,
    emergencyEmail: document.getElementById('emergency_email').value,
    emergencyAddress: document.getElementById('emergency_address').value,
  };

  // å¿…é ˆãƒã‚§ãƒƒã‚¯
  if(!formData.userLastName || !formData.emergencyLine || !formData.emergencyEmail) {
    alert("å¿…é ˆé …ç›®(*)ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  try {
    // 1. Make.comã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
    await fetch(MAKE_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    // 2. Stripeæ±ºæ¸ˆã¸
    window.location.href = `${STRIPE_URL}?client_reference_id=${profile.userId}`;
    
  } catch (e) {
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
  }
}

initLIFF();
</script>

</body>
</html>
